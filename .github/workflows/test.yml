name: Test Docusaurus Build

on:
  pull_request:
    branches:
      - main

jobs:
  test-build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 18
          cache: npm

      - name: Install dependencies
        run: npm install
      - name: Build API docs
        run: npm run docusaurus gen-api-docs all
      - name: Build
        run: npm run build


    
      - name: Check PR file names for invalid characters
        run: |
            echo "Checking modified file names..."
            files=$(git diff --name-only origin/main...HEAD)
            invalid_files=""
            for file in $files; do
            filename=$(basename "$file")
            if echo "$filename" | grep -q '[^a-zA-Z0-9_.\-]'; then
                invalid_files="$invalid_files\n$file"
            fi
            done

            if [ -n "$invalid_files" ]; then
            echo "❌ Invalid file names detected:"
            echo -e "$invalid_files"
            echo "Only a-z, A-Z, 0-9, underscore (_), hyphen (-), and dot (.) are allowed."
            exit 1
            else
            echo "✅ All file names are valid."
            fi